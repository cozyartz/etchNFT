---
import Meta from '../components/Meta.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import PageTransition from '../components/PageTransition.astro';
import { CartProvider } from '../components/react/CartContext';

const {
  title = 'EtchNFT â€“ Bring NFTs to Life',
  description = 'Order laser-etched physical plaques of your NFTs, with crypto or card. Powered by Polygon.',
  image = '/og-image.png',
  url = 'https://etchnft.com'
} = Astro.props;
---

<html lang="en" class="scroll-smooth dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <Meta {title} {description} {image} {url} />

    <!-- Global Styles -->
    <link rel="stylesheet" href="/src/styles/global.css" />

    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"></noscript>
    
    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/53a31143f8.js" crossorigin="anonymous" async></script>

    <!-- Square Payments SDK (sandbox) -->
    <script src="https://sandbox.web.squarecdn.com/v1/square.js" defer></script>
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://kit.fontawesome.com">
    <link rel="dns-prefetch" href="https://sandbox.web.squarecdn.com">
    
    <style>
      .retro-grid {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(var(--accent) 1px, transparent 1px),
          linear-gradient(90deg, var(--accent) 1px, transparent 1px);
        background-size: 50px 50px;
        opacity: 0.05;
        z-index: -1;
        pointer-events: none;
      }
    </style>
  </head>

  <body class="hero-gradient text-white transition-colors duration-300 fade-in-up min-h-screen">
    <div class="retro-grid"></div>
    <CartProvider client:only="react">
      <Nav />

      <main class="min-h-screen relative z-10 px-4 sm:px-8 py-8">
        <slot />
      </main>

      <Footer />
    </CartProvider>

    <script>
      const toggle = document.getElementById('theme-toggle');
      toggle?.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem(
          'theme',
          document.documentElement.classList.contains('dark') ? 'dark' : 'light'
        );
      });

      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    </script>
  </body>
</html>
